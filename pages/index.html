<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Evetry - Icon</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
  </head>
  <body class="container-sm">
    <h1 class="mb-4">Evetry Icon</h1>

    <ul
      id="icon-lists"
      class="row row-cols-3 row-cols-sm-4 row-cols-lg-6 row-cols-xl-8 list-unstyled list"
    ></ul>

    <script type="text/javascript">
      function initTooltip() {
        // Tootip
        const tooltipTriggerList = document.querySelectorAll(
          '[data-bs-toggle="tooltip"]'
        );
        const tooltipList = [...tooltipTriggerList].map(
          (tooltipTriggerEl) => new bootstrap.Tooltip(tooltipTriggerEl)
        );
      }

      // Handle contents
      var html = String.raw;
      var iconListsContainer = document.getElementById("icon-lists");

      window.addEventListener("DOMContentLoaded", () => {
        fetchData();
      });

      function getData(dirValue) {
        // Panggil fungsi yang ingin Anda jalankan ketika nilai dir berubah
        console.log("Nilai dir berubah:", dirValue);
      }

      // Change Dir
      function changeDirValue(newDirValue) {
        const searchParams = new URLSearchParams(window.location.search);
        const currentDir = searchParams.get("dir");
        searchParams.set("dir", `${currentDir ?? ""}/${newDirValue}`);

        const newUrl = window.location.pathname + "?" + searchParams.toString();
        history.pushState(null, "", newUrl);

        fetchData();
      }

      function fetchData() {
        const searchParams = new URLSearchParams(window.location.search);
        const currentDir = searchParams.get("dir");

        iconListsContainer.innerHTML = "";

        fetch(`https://icon.evetry.com${currentDir ?? ""}/index.json`).then(
          async (res) => {
            const json = await res.json();
            console.log(json);

            // Buat folder
            json.dir.forEach((dir) => {
              const el = document.createElement("li");
              el.onclick = () => {
                changeDirValue(dir);
              };
              el.className = "col mb-4";
              el.innerHTML = html`<div
                class="d-block text-body-emphasis text-decoration-none"
              >
                <div
                  class="px-3 py-4 mb-2 bg-body-secondary text-center rounded"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="42"
                    height="42"
                    fill="currentColor"
                    class="bi bi-folder2"
                    viewBox="0 0 16 16"
                  >
                    <path
                      d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v7a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 1 12.5v-9zM2.5 3a.5.5 0 0 0-.5.5V6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5zM14 7H2v5.5a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5V7z"
                    />
                  </svg>
                </div>
                <div
                  class="name text-muted text-decoration-none text-center pt-1"
                >
                  ${dir}
                </div>
              </div>`;

              iconListsContainer.appendChild(el);
            });

            // create icon list

            json.images.forEach((image) => {
              const el = document.createElement("li");
              el.onclick = () => {
                const url = `https://icon.evetry.com${image.path}`;
                copyToClipboard(url);
              };
              el.className = "col mb-4";
              el.innerHTML = html`<div
                class="d-block text-body-emphasis text-decoration-none"
              >
                <div class="px-3 py-4 mb-2 bg-light text-center rounded">
                  <img
                    loading="lazy"
                    data-bs-toggle="tooltip"
                    data-bs-title="Klik untuk menyalin"
                    src="https://icon.evetry.com${image.path}"
                    height="42"
                    width="42"
                  />
                </div>
                <div
                  class="name fs-6 text-muted text-decoration-none text-center text-truncate pt-1"
                >
                  <span>https://icon.evetry.com${image.title}</span>
                </div>
              </div>`;

              iconListsContainer.appendChild(el);
            });

            // Init Tooltip
            initTooltip();
          }
        );
      }

      window.addEventListener("popstate", () => {
        fetchData();
      });

      function copyToClipboard(text) {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        // textarea.style.display = "none";

        document.body.appendChild(textarea);

        textarea.select();
        document.execCommand("copy");

        document.body.removeChild(textarea);
      }

      // Contoh penggunaan
      const stringToCopy = "Halo, dunia!";
      copyToClipboard(stringToCopy);
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"
      integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
